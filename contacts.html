{% extends "base.html" %}
{% block css %}contacts{% endblock %}
{% block title %}Contacts{% endblock %}
{% block content %}

<div id="contact-list">
    <div class="row medium-margin-top">
        <div class="col-md-4">

        </div>
    </div>

    <div class="row">
        <div class="">
            <div class="col-md-2">
                <a class="btn btn-success add-contact" href="contacts/new">New Contact</a>
            </div>
            <div class="col-md-2">
                <a class="btn add-group" href="#">New Group</a>
            </div>
            <div class="col-md-2 import-csv-container">
                <a href="#">
                    <div class="btn btn-file"> CSV import<input id="import-csv" type="file"></div>
               </a>
            </div>
        </div>
    </div>

    <div class="row small-margin-top">
        <div class="col-md-6 container ">
            <h4>Contacts</h4>
            <div id="contacts_table" class="small-margin-top"></div>
        </div>
        <div class="col-md-6">
            <h4>Groups</h4>
            <div id="groups_accordion" class="panel-group groups_table" role="tablist" aria-multiselectable="true"></div>
        </div>
    </div>

</div>

<div id="contact-new"></div>

{% endblock %}

{% block initScript %}
 <script>

    var groupList = new GroupList();
    {% for group in contact_groups['groups']%}
        groupList.create({unique_id: "{{group.unique_id}}", name:"{{group.name}}"});
    {% endfor %}

    var contactList = new ContactList();
    {% for contact in contact_groups['contacts']%}

        var xcontact = new Contact({
            unique_id: "{{contact.unique_id}}",
            name:"{{contact.name}}",
            email:"{{contact.email}}",
            phone:"{{contact.phone}}",
            groups: [
                {% for groupId in contact['groups']%}
                    '{{groupId}}',
                {% endfor%}
            ]
        });

        xcontact.get('groups').forEach(function(item){
            var group = groupList.getById(item);

            if(group != null && group.length >0)
                group[0].get('contacts').add(xcontact);
        });

        contactList.add(xcontact);
    {% endfor %}


</script>
{% endblock %}