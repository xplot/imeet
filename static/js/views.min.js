function alert_notification(a){var b=$("#notification-alerts");b.length||(b=$('<div id="notification-alerts" class="jumbotron flyover flyover-bottom"><button class="btn btn-primary alert-close" data-dismiss="alert">X</button></div>'),$("body").append(b)),a.forEach(function(a){b.prepend("            <div class='alert alert-"+a.alertType+"'>"+a.message+"</div>")}),a.length>0&&b.toggleClass("in")}var validator={digitsRegex:new RegExp("^[0-9]*$"),charsRegex:new RegExp(".*"),emailRegex:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,validateItems:function(a){var b=!0,c=$(a);return c.each(function(a){var d=$(c[a]);b=validator.validateItem(d)&&b}),b},validateString:function(a,b){var c=!1;switch(b){case"required":c=a.length>0;break;case"digits":c=validator.digitsRegex.test(a);break;case"non_numerics":c=validator.charsRegex.test(a);break;case"email":c=0==a.length||validator.emailRegex.test(a);break;case"phone":c=validator.digitsRegex.test(a)&&(10==a.length||0==a.length);break;case"date":var d=new Date(a);c=d instanceof Date&&!isNaN(d.valueOf())}return c},validateItem:function(a){var b=!0,c=a.data("validation");return c.split(",").forEach(function(c){var d=-1;if(c.indexOf(":")>=0){var e=c.split(":");c=e[0],d=parseInt(e[1])}var f;try{var g=a.val();a.is(":checkbox")&&(a.is(":checked")||(g="")),f=-1==c.indexOf("|")?validator.validateString(g,c):validator.validateString(g,c.split("|")[0])||validator.validateString(g,c.split("|")[1]),-1!=d&&(f=f&&g.length==d)}catch(h){f=!1}b=f&&b}),a.is(":checkbox")&&(a=a.parent()),b?a.removeClass("failed-validation"):a.addClass("failed-validation"),b}};ModalView=Backbone.View.extend({childView:null,template:null,initialize:function(a){this.options=a||{},this.childView=this.options.childView,this.template=this.options.template,(null==Backbone.pubSub._events||null==Backbone.pubSub._events.childClose)&&Backbone.pubSub.on("childClose",this.onChildClose,this)},render:function(a){this.$el;var b=this;if(null!=this.options.templateId){var c=_.template($(this.options.templateId).html(),{});this.$el.html(c)}else null!=this.template&&this.$el.html(this.template());return null!=this.childView&&this.childView.render(a),this.$el.find(".close-modal").click(function(){b.onChildClose({view:b.childView})}),this.$el.modal("show"),this},onChildClose:function(){null!=this.$el&&this.$el.modal("hide"),Backbone.history.navigate("",!0)}}),SimpleView=Backbone.View.extend({initialize:function(a){this.options=a||{}},render:function(){if($("#body-container").hide(),null!=this.options.templateId){var a=_.template($(this.options.templateId).html(),{});this.$el.html(a),this.$el.show()}}}),IndexView=Backbone.View.extend({initialize:function(a){this.options=a||{}},events:{"click .imeet-btn":"createNew","keypress .invite-title-input":"type_key"},type_key:function(a){return 13==a.keyCode?(this.createNew(),a.preventDefault(),!1):void 0},render:function(){$("#view-container").hide(),this.$el.show(),this.$inviteTitle=this.$el.find(".invite-title-input"),this.$headerImage=this.$el.find(".header-section")},createNew:function(){var a=this.$inviteTitle.val();null!=a&&""!=a?Backbone.history.navigate("/new/"+a,!0):alert("type a title!")}}),InviteView=Backbone.View.extend({template:JST["inviteReport.html"],inviteId:null,initialize:function(a){this.options=a||{},this.inviteId=this.options.id},render:function(a){this.inviteId=a.invite_id,null==this.inviteId&&console.error("Invite Id is null, check routing"),this.$el.html(this.template()),$.ajax({url:"/api/invite/"+this.inviteId,type:"GET",cache:!1,success:function(a){var b=$(".invite-title"),c=$(".invite-date"),d=$(".invite-table");b.html(a.title),c.html(a.when);var e="            <div id='contact{3}' class='row contact-row small-margin' data-contact='{0},{1},{2}' >                     <div class='col-sm-2'> {0} </div>                     <div class='col-sm-2'>  {1} </div>                     <div class='col-sm-2'> {2}</div>                     <div class='col-sm-2'> {3}</div>                     <div class='col-sm-2'> {4}</div>                     <div class='col-sm-2'> {5}</div>             </div> ";a.contacts.forEach(function(a){d.append(e.format(a.name||"N/A",a.phone||"N/A",a.email||"N/A",a.sms_response||'<span class="text-danger">N/A</span>',a.voice_response||'<span class="text-danger">N/A</span>',a.email_response||'<span class="text-danger">N/A</span>'))})}})}}),CreateView=Backbone.View.extend({el:"#header-container",new_contact_string:"            <div id='contact{2}'  class='row controls' data-contact='{0},{1},{2}'>                <div class='col-sm-5 form-group'> {0}</div>                <div class='col-sm-5 form-group'> {1}</div>                <div class='col-sm-2 form-group'>                     <button type='button' class='btn btn-danger remove-contact form-control' data-row='{2}'>-</button>                              </div>             </div>",initialize:function(a){this.options=a||{}},events:{"click .new-contact":"newContact","click .remove-contact":"removeContact","click .send":"submitNew"},template:JST["invite.html"],render:function(a){return $("#body-container").hide(),$("#view-container").show(),$("#modal_container").modal("hide"),this.$el.html(this.template()),this.$table=this.$el.find(".contact-table"),this.$btSend=this.$el.find(".send"),this.$contactForm=this.$el.find("#newContactForm"),this.$inviteForm=this.$el.find("#newInviteForm"),this.$new_name=this.$el.find(".new-contact-name"),this.$new_phone=this.$el.find(".new-contact-phone"),this.$event_name=this.$el.find(".event-name"),this.$event_date=this.$el.find(".event-date"),this.$btSend=this.$el.find(".send"),this.i=0,null!=a.title&&this.$event_name.val(a.title),null!=a.id&&this.createFromInvite(a.id),this},createFromInvite:function(a){var b=this;$.ajax({url:"/api/invite/"+a,type:"GET",cache:!1,success:function(a){a.contacts.forEach(function(a){b.$table.prepend(b.new_contact_string.format(a.name||"",a.phone||"",a.email||"",this.i)),this.i++}),b.$btSend.removeAttr("disabled")},error:function(a){alert_notification([{alertType:"danger",message:a.responseText}])}})},newContact:function(){if(validator.validateItem(this.$new_phone)){var a=this.new_contact_string.format(this.$new_name.val(),this.$new_phone.val(),this.i);return this.$new_name.val(""),this.$new_phone.val(""),this.$table.append(a),this.i++,this.$btSend.removeAttr("disabled"),!1}},removeContact:function(a){var b="#contact"+$(a.currentTarget).data("row");this.$table.find(b).remove();var c=this.$el.find(".contact-row");(null==c||0==c.length)&&this.$btSend.attr("disabled","disabled")},submitNew:function(){var a=this;if(validator.validateItems(".valid-before-submit")){var b=this.$el.find(".contact-row"),c={title:this.$event_name.val(),when:this.$event_date.val(),user_id:null!=currentUser?currentUser.id:null,contacts:[]};b.each(function(){var b=$(this).data("contact"),d=b.split(","),e=a.parsePhoneAndEmail(d[1]);c.contacts.push({name:d[0],email:e.email,phone:e.phone})}),$.ajax({url:"/api/invite",type:"POST",data:JSON.stringify(c),cache:!1,success:function(){a.$el.modal("hide"),Backbone.history.navigate("",!0)}})}},parsePhoneAndEmail:function(a){a.trim();var b=a.split(";");1==b.length&&(b=a.split(","));for(var c=0;c<b.length;c++)b[c]=b[c].trim();return 1==b.length?isNaN(b[0][0])?{email:b[0]}:{phone:b[0]}:isNaN(b[0][0])?{phone:b[0],email:b[1]}:{email:b[0],phone:b[1]}}}),SearchView=Backbone.View.extend({template:JST["search.html"],invite_string:"            <div class='row'>                     <div class='col-sm-3 col-md-offset-2'>  <a href='#' class='navigate' data-action='modal' data-where='view/{0}'>{1}</a> </div>                     <div class='col-sm-3'>  {2} </div>                     <div class='col-sm-1'> <button type='button' class='navigate btn btn-info form-control' data-where='new/from/{0}'>Copy</button></div>             </div> ",initialize:function(a){this.options=a||{}},events:{"click .search":"search","keypress #searchBox":"type_key"},render:function(){this.$el.html(this.template()),this.$searchBox=this.$el.find("#searchBox"),this.search()},type_key:function(a){return 13==a.keyCode?(this.search(),a.preventDefault(),!1):void 0},search:function(){var a=this;$.ajax({url:"/api/invite/search/"+currentUser.id+"?term="+this.$searchBox.val(),type:"GET",cache:!1,success:function(b){if(null!=b){var c=$(".search-result");c.empty(),b.forEach(function(b){c.append(a.invite_string.format(b.unique_id,b.title,b.when))})}}})}}),UserRegisterView=Backbone.View.extend({template:JST["register.html"],initialize:function(a){this.options=a||{}},events:{"click .submit-register":"registerEmail"},render:function(){this.$el.html(this.template()),this.$registerForm=this.$el.find("#registerForm"),this.$email=this.$el.find(".register-email")},registerEmail:function(){if(this.$registerForm.validate(),this.$registerForm.valid()){var a=this;$.ajax({url:"/register/email/"+this.$email.val(),type:"POST",cache:!1,success:function(){Backbone.pubSub.trigger("childClose",{view:a})},error:function(a){alert_notification([{alertType:"danger",message:a.responseText}])}})}}}),UserProfileView=Backbone.View.extend({template:JST["editProfile.html"],initialize:function(a){this.options=a||{}},events:{"click .save-profile":"save"},render:function(){this.$el.html(this.template()),this.$editProfileForm=this.$el.find("#editProfileForm"),this.$name=this.$el.find("#edit-profile-name"),this.$username=this.$el.find("#edit-profile-username"),this.$password=this.$el.find("#edit_profile_password"),this.$email=this.$el.find("#edit-profile-email");var a=this;$.ajax({url:"/api/profile/"+currentUser.id,type:"GET",cache:!1,success:function(b){null!=b.email&&(a.$email.html(b.email),a.$email.parent().addClass("floating-label-form-group-with-value")),null!=b.username&&(a.$username.val(b.username),a.$username.parent().addClass("floating-label-form-group-with-value")),null!=b.name&&(a.$name.val(b.name+" "+b.last_name),a.$name.parent().addClass("floating-label-form-group-with-value"))}})},save:function(){if(this.$editProfileForm.validate({rules:{edit_profile_password:{minlength:5},edit_profile_password_confirm:{minlength:5,equalTo:"#edit_profile_password"}}}),this.$editProfileForm.valid()){var a={username:this.$username.val(),password:this.$password.val()};null!=this.$name.val()&&(a.name=this.$name.val().split(" ")[0],a.last_name=this.$name.val().split(" ")[1]);var b=this;$.ajax({url:"/api/profile/"+currentUser.id,type:"POST",data:JSON.stringify(a),cache:!1,success:function(){Backbone.pubSub.trigger("childClose",{view:b})}})}}});